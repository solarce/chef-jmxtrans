{
 "servers": [
 <% @servers.each_with_index do |(server, server_data), index| -%>
 {
  "host": "<%= server_data['name'] %>",
  "port": <%= server_data['port'] %>,
  "numQueryThreads": 2,
  "queries": [{
     <% server_data['queries'].to_a.each_with_index do |query,index| -%>
     "obj": "<%= query['obj'] %>",
     "attr": [<%= query['attr'].map {|t| "\""+t.to_s+"\""}.join(', ') %>],
     "outputWriters": [{
        "@class": "com.googlecode.jmxtrans.model.output.GraphiteWriter",
        "settings": {
           "typeNames": ["name"],
           "host": "<%= @graphite_host %>",
           "port": <%= @graphite_port %>,
           "rootPrefix": "<%= @root_prefix %>"
        }
      <% if index == (server_data['queries'].length - 1) -%>
      }]
      <% else -%>
      }],
      <% end -%>
    <% end -%>
  }]
<% if index == (@servers.length - 1) -%>
}
<% else -%>
},
<% end -%>
<% end -%>
]
}
